<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Results - AI Job Agent</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: #0f1115; color: #e6e6e6; margin: 0; padding: 20px;
    }
    .wrap { max-width: 980px; margin: 0 auto; }
    h1 { margin: 10px 0 4px; }
    .meta { color: #9aa0a6; margin-bottom: 24px; }
    .card {
      background: #171923; border: 1px solid #2a2f3a; border-radius: 12px;
      padding: 16px; margin-bottom: 16px;
    }
    .title { font-size: 18px; margin: 0 0 6px; }
    .sub { color: #aab2bf; margin: 0 0 8px; }
    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    a.btn {
      display: inline-block; padding: 10px 14px; border-radius: 8px; text-decoration: none;
      background: #2d6cdf; color: #fff; font-weight: 600;
    }
    pre {
      white-space: pre-wrap; word-wrap: break-word;
      background: #0b0d12; border: 1px solid #202431; padding: 12px; border-radius: 8px;
    }
    .empty {
      background: #1b1f2a; padding: 16px; border-radius: 10px; color: #9aa0a6;
    }
    .top-actions { margin: 12px 0 20px; }
    .top-actions a { color: #9aa0a6; text-decoration: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Matched Jobs</h1>
    <div class="top-actions"><a href="index.html">← Back</a></div>
    <div id="meta" class="meta"></div>
    <div id="results"></div>
  </div>

  <script>
    const raw = sessionStorage.getItem("ai_job_agent_results");
    const metaEl = document.getElementById("meta");
    const resultsEl = document.getElementById("results");

    if (!raw) {
      metaEl.innerHTML = "<span class='sub'>No results found in this session. Please run a new search.</span>";
    } else {
      const data = JSON.parse(raw);
      const { domain, location, matched_jobs } = data || {};
      metaEl.innerHTML = `Domain: <strong>${domain || "-"}</strong> • Location: <strong>${location || "-"}</strong>`;

      if (!matched_jobs || !matched_jobs.length) {
        resultsEl.innerHTML = `<div class="empty">No matches found. Please try a different domain or location.</div>`;
      } else {
        resultsEl.innerHTML = matched_jobs.map(job => {
          const title = job.title || "Untitled Role";
          const company = job.company || "Unknown Company";
          const loc = job.location || "";
          const link = job.link && job.link !== "#" ? `<a class="btn" href="${job.link}" target="_blank" rel="noopener">Apply</a>` : `<span class="sub">No direct apply link found</span>`;
          const cover = job.cover_letter ? `<p class="sub">Tailored Cover Letter:</p><pre>${job.cover_letter}</pre>` : "";

          return `
            <div class="card">
              <p class="title">${title} — ${company}</p>
              <p class="sub">${loc}</p>
              <div class="row" style="margin: 10px 0 14px;">${link}</div>
              ${cover}
            </div>
          `;
        }).join("");
      }
    }
  </script>
</body>
</html>
